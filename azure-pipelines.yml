# Android
# Build your Android project with Gradle.
# Add steps that test, sign, and distribute the APK, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/android

# Android
# Build a Gradle-based Android project.
# Add steps that test, sign, and distribute an app, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/android

variables:
- group: AppVariables-Common
- group: AppVariables-EAS

trigger:
- test/azure-extension-eas

pool:
  vmImage: 'ubuntu-latest'

steps:
# - task: DownloadSecureFile@1
#   name: keystore
#   inputs:
#     secureFile: 'ac-sample.jks'

# BUILD START
# - task: Gradle@2
#   inputs:
#     workingDirectory: ''
#     gradleWrapperFile: 'gradlew'
#     gradleOptions: '-Xmx3072m'
#     publishJUnitResults: false
#     testResultsFiles: '**/TEST-*.xml'
#     tasks: 'clean assembleRelease'
#     # options: '-PkeystoreFile=$(keystore.secureFilePath) -PkeystorePassword=$(keystorePassword) -PkeyAlias=$(keyAlias) -PkeyPassword=$(keyPassword)'

# - task: AndroidSigning@3
#   inputs:
#     apkFiles: '**/*.apk'
#     apksignerKeystoreFile: 'ac-sample.jks'
#     apksignerKeystorePassword: '$(keystorePassword)'
#     apksignerKeystoreAlias: '$(keyAlias)'
#     apksignerKeyPassword: '$(keyPassword)'

# - task: CopyFiles@2
#   inputs:
#     contents: '**/*.apk'
#     targetFolder: '$(build.artifactStagingDirectory)'
#     overWrite: true
#     flattenFolders: true

# - task: CmdLine@2
#   inputs:
#     script: 'mv app-release-unsigned.apk app-release-signed.apk'
#     workingDirectory: '$(build.artifactStagingDirectory)'
#   displayName: 'Rename APK'

# - task: PublishBuildArtifacts@1
#   inputs:
#     pathToPublish: '$(Build.ArtifactStagingDirectory)'
#     artifactName: 'ac-sample-artifact'
#     publishLocation: 'Container'
# BUILD END

# - task: AppcircleEnterpriseStore@0
#   inputs:
#     accessToken: '$(ac-pat)'
#     entProfileId: '$(ac-entp-profile-id-android)'
#     appPath: '$(Build.ArtifactStagingDirectory)/app-release-signed.apk'
#     summary: '$(ac-summary-notes)'
#     releaseNotes: '$(ac-release-notes)'
#     publishType: 'Beta'

- task: CmdLine@2
  inputs:
    script: |
      pwd
      ls ./*

- task: AppcircleEnterpriseStore@0
  inputs:
    personalAPIToken: '$(ac-pat)'
    # appPath: '$(Build.ArtifactStagingDirectory)/app-release-signed.apk'
    appPath: './build/test/broken.apk'
    summary: '$(ac-summary-notes)'
    releaseNotes: '$(ac-release-notes)'
    publishType: 'Live'
